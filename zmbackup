#!/bin/bash

################################################
# Zimbra backup script for open source edition #
################################################

ZIMBRA_HOME=/opt/zimbra
ZIMBRA_BIN=$ZIMBRA_HOME/bin
ZIMBRA_BACKUP_DIR=$ZIMBRA_HOME/backup 

create_backup ()
{
	mail_account=$2
	# backup
	$ZIMBRA_BIN/zmmailbox -z -m $mail_account getRestURL "//?fmt=zip" > $ZIMBRA_BACKUP_DIR/$mail_account-$1.zip
	# return in tar.gz format
	cd $ZIMBRA_BACKUP_DIR
	tar czf $mail_account-$1.tar.gz $mail_account-$1.zip
	rm $mail_account-$1.zip
	cd $ZIMBRA_BIN
}

